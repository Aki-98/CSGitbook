# 常用知识

Linux发行版本：

Debian Ubuntu RedHat Fedora CentOS



GUN/POSIX：

- GUN：GUN软件可以自由地“使用、复制、修改和发布”
- POSIX：可移植操作系统接口，提高UNIX环境下应用程序的可移植性；遵循POSIX标准的操作系统编写的程序，可在其它任何遵循POSIX标准的操作系统上运行



远程终端访问：

- 工具：XFTP FileZilla SecureCRT XShell
- SSH：用于网络传输的协议；SFTP：用于远程文件管理的协议。



# 系统启动过程

过程分为五个阶段：

- 内核的引导
  - xu当计算机打开电源后，首先是BIOS开机自检，按照BIOS中设置的启动设备（通常是硬盘）来启动
  - 操作系统接管硬件以后，首先读入/boot目录下的内核文件
- 运行init
  - init进程是系统所有进程的起点，没有这个进程，系统中的任何进程都不会启动
  - init进程首先需要读取配置文件/etc/inittab
  - 运行级别
    - 许多程序需要开机启动，它们在Windows叫做“服务”，在Linux叫做守护进程。init进程的一大任务就是去运行这些开机启动的程序。但是不同的场合需要启动不同的程序，比如用作服务器时需要启动Apache，用作桌面就不需要。Linux允许为不同的场合，分配不同的开机启动程序，这就叫做“运行级别”，也就是说，启动时根据“运行级别”，确定要运行哪些程序。
    - Linux系统有七个运行级别：
      - 0：系统停机状态，系统默认运行级别不能设置为0，否则不能正常启动
      - 1：单用户工作状态，root权限，用于系统维护，禁止远程登录
      - 2：多用户状态（没有NFS）
      - 3：完全的多用户状态（有NFS），登录后进入控制台命令行模式
      - 4：系统未使用，保留
      - 5：X11控制台，登陆后进入图形GUI模式
      - 6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动
- 系统初始化
  - 在init的配置文件中有这么一行：si::sysinit:/ect/rc.d/rc.sysinit它调用执行了/etc/rc.d/rc.sysinit，而rc.sysinit是一个bash shell的脚本，它主要是完成一些系统初始化的工作，rc.sysinit是每一个运行级别都要首先运行的重要脚本。它主要完成的工作有：激活交换分区、检查磁盘，加载硬件模块以及其它一些需要优先执行的任务。
- 建立终端
  - rc执行完毕后，返回init，这时基本系统环境已经设置好了，各种守护进程也已经启动了。init接下来会打开6个终端，以便用户登录系统。在inittab中的以下6行就是定义了6个终端：
  - ![image-20230414135734809](Linux - Others_imgs\jmror3x9Aau.png)
  - 从上面可以看出在2、3、4、5的运行级别中都将以respawn方式运行mingetty程序，mingetty程序能打开终端、设置模式。
  - 同时它会显示一个文本登录界面，这个界面就是我们经常看到的登录界面，在这个登录界面中会提示用户输入用户名，而用户输入的用户将作为参数传给login程序来验证用户的身份。

- 用户登录系统
  - 一般来说，用户的登陆方式有三种：命令行登录、ssh登录、图形界面登录
  - 图形界面登录流程：
    - 当用户看到mingetty的登录界面时，就可以输入用户名和密码来登录系统了。
    - Linux的账号验证程序时login，login会接受mingetty传来的用户名作为用户名参数。
    - 然后login会对用户名进行分析，如果用户名不是root，且存在/etc/nologin文件，login将输出nologin文件的内容，然后退出。
    - 这通常用来系统维护时防止非root用户登录，只有/etc/securetty中登记了的终端才允许root用户登录，如果不存在这个文件，则root用户可以在任何终端上登录
    - /etc/usertty文件用户对用户作出附加访问限制，如果不存在这个文件，则没有其他限制。
  - 图形界面与文字模式的切换方式：
    - Linux预设提供了六个命令窗口终端机让我们来登录。
    - 默认我们登录的就是第一个窗口，也就是tty1，这个六个窗口分别为tty1, tty2，...tty6，
      你可以按下Ctrl+Alt+F1~F6来切换它们。
    - 如果你安装了图形界面，默认情况下是进入图形界面的，此时你就可以按Ctrl+Alt+Fl~F6来进入其中一个命令窗口界面。
    - 当你进入命令窗口界面后再返回图形界面只要按下Ctrl+Alt+F7就回来了。
    - 如果你用的vmware虚拟机，命令窗口切换的快捷键为Alt+Space+F1~F6如果你在图形界面下请按+Shift+Ctrl+Fl~F6切换至命令窗口。

Linux关机：

在linux领域内大多用在服务器上，很少遇到关机的操作。毕竟服务器上跑一个服务是永无止境的，除非特殊特殊下，不得已才会关机。

正确的关机流程为：sync>shutdown>reboot>halt：

- sync将数据由内存同步到硬盘中。
- shutdown关机指令：
  - shutdown -h now 立马关机
  - shutdown -h 20:25 今天20:25关机
  - shutdown -h +10 10分钟后关机
  - shutdown -h 10 "shown_msg" 10分钟后关机，并且会显示信息到用户当前的屏幕中
  - shutdown -r now 系统立马重启
  - shutdown -r +10 系统十分钟后立马重启
- reboot 重启，等同于 shutdown -r now
- halt 关闭系统，等同于 shutdown -h now 和 poweroff

不管是重启系统还是关闭系统，首先要运行sync命令，把内存中的数据写到磁盘中

# 用户态与内核态

用户态：完全在操作系统内核中进行，拥有对硬件的所有操作权限，任何异常都可能导致整台机器停机。

内核态：在应用程序中进行，没有对硬件的直接控制权限，也不能直接访问地址的内存，程序时通过调用系统接口来达到访问硬件和内存，在这种保护牧场下，即使程序发生崩溃也可以恢复。

用户态和内核态之间切换的开销：

- 保留用户态现场（上下文、寄存器、用户栈等）
- 复制用户态参数，用户栈切到内核栈，进入内核态
- 额外的检查（因为内核代码对用户不信任）
- 执行内核态代码
- 复制内核态代码执行结果，回到用户态
- 恢复用户态现场（上下文、寄存器、用户栈等）

![image-20230414163904581](Linux - Others_imgs\yKOwvR2kABq.png)

从上图我们可以看出来通过系统调用将Linux整个体系分为用户态和内核态，为了使应用程序访问到内核的资源，如CPU、内存、I/O，内核必须提供一组通用的访问接口，这些接口就叫系统调用。

库函数就是屏蔽这些复杂的底层实现细节，减轻程序员的负担，从而更加关注上层的逻辑实现，它对系统调用进行封装，提供简单的基本接口给程序员。

Shell顾名思义，就是外壳的意思，就好像把内核包裹起来的外壳，它是一种特殊的应用程序，俗称命令行。Shell也是可编程的，它有标准的Shell 语法，符合其语法的文本叫Shell脚本，很多人都会用Shell脚本实现一些常用的功能，可以提高工作效率。

最后来说说，什么情况会导致用户态到内核态切换

- 系统调用：用户态进程主动切换到内核态的方式，用户态进程通过系统调用向操作系统申请资源完成工作，例如 fork（）就是一个创建新进程的系统调用，系统调用的机制核心使用了操作系统为用户特别开放的一个中断来实现，如Linux 的 int 80h 中断，也可以称为软中断
- 异常：当 C P U 在执行用户态的进程时，发生了一些没有预知的异常，这时当前运行进程会切换到处理此异常的内核相关进程中，也就是切换到了内核态，如缺页异常
- 中断：当 C P U 在执行用户态的进程时，外围设备完成用户请求的操作后，会向 C P U 发出相应的中断信号，这时 C P U 会暂停执行下一条即将要执行的指令，转到与中断信号对应的处理程序去执行，也就是切换到了内核态。如硬盘读写操作完成，系统会切换到硬盘读写的中断处理程序中执行后边的操作等。

